
测序中的文件格式

	多种文件格式：https://genome.ucsc.edu/FAQ/FAQformat.html



========================================
简并碱基
----------------------------------------

R:AG
Y:CT
M:AC
K:GT
S:GC
W:AT

H:ATC
B:GTC
V:GAC
D:GAT

N:ATGC

这些出现在密码子中的时候可能翻译成同一种氨基酸


RNA中的U，对应DNA中的T。






========================================
fastq - 首行意义、质量分数
----------------------------------------
1.fq文件第一行是标识符
https://en.wikipedia.org/wiki/FASTQ_format
http://blog.csdn.net/chen_amiao/article/details/52890481


Illmina有多种测序仪，从早期的GA、Hiseq2000、Hiseq2500以及即将推广的Hiseq X。 
Hiseq2000一个flowcell中包含8个lane，每个lane可以测一个文库或多样本的混合文库，多样本混合文库如果需要后期区分则每个文库需要一个独特的标签，即Index。其中一个lane包含3列(3个Swath)，每一列又包含8个tile，每一个tile又会种下不同的cluster，如图1所示为Hiseq2500的FlowCell的一个表面。


(1)例子：配对的Read1和Read2文件中的编号：
@E00300:165:H3CMMALXX:6:1101:1945:2047 1:N:0:GGACTCCT
@E00300:165:H3CMMALXX:6:1101:1945:2047 2:N:0:GGACTCCT

E00300	仪器编号the unique instrument name
165	the run id
H3CMMALXX	芯片编号 the flowcell id
6	芯片通道 flowcell lane
1101	芯片通道内的片号 tile number within the flowcell lane
1945	横坐标 'x'-coordinate of the cluster within the tile
2047	纵坐标 'y'-coordinate of the cluster within the tile
1	the member of a pair, 1 or 2 (paired-end or mate-pair reads only)
Y	Y if the read is filtered, N otherwise
0	0 when none of the control bits are on, otherwise it is an even number
GGACTCCT	index sequence

(2)注意：新版本的Illumina软件输出样品编号（来自样品表）而不是index序列。
For example, the following header might appear in the first sample of a batch:
@EAS139:136:FC706VJ:2:2104:15343:197393 1:N:18:1

而之前是：
@EAS139:136:FC706VJ:2:2104:15343:197393 1:Y:18:ATCACG




2.fq文件第四行是质量分数 

测得不好的R1(经过poly T后质量下降)：
@E00300:165:H3CMMALXX:6:1101:1945:2047 1:N:0:GGACTCCT
TCTAGCAGTCTATTATTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTCTTTTTCCTTTAAAAATTTCCGAGCCCACAGCACGAACTTCTATCTCATATTCCGCTTTTATTTTGAAAAAAAAAAAATAATGTAAAATAAAAAGTACAAA
+
AAFFFFFAAAF,77,7AFFF,F<,<FKKKKKKKKKKKKKKKA,,,7F7,,,,7,,,,,,7,,7,,,,,,,,,,(,,,(,,,,,,,7<,,,,,,,,7,,,,,,,A,,,,,,,,,,,,,,,,<<F7<,7,,,,,,,,,,,7,,,,,,,,7,,

测得好的R2：
@E00300:165:H3CMMALXX:6:1101:2575:2047 2:N:0:GGACTCCT
CACTTTAGAATTTGTATAAGAAACTGGTCCATGTAAGTACTTTCCATGTTTTCTCTTCAAATGTTTAAAGTGCTAGCTGATGTACGTACGATATCTCTTCTCAGATATTTGCCTGGCTGTTTACCCAAAGTTGCTTCTAAATCAATACAG
+
A<AFFKKKKKKKKAKKKFKKA7FKKFKFKKKFFKKKKKKFKFKKFAKKFKKKKK7<FKKKKKKKK,FFKKFFKAFFKKKKKFKKKKKKKF<FFAFAAFKAF<,,,FFKKKKKKFK(AAFFKFKKKKAAA,<AKKFKKK,,,<F<,<K,<<


Qillumina-prior to v.1.4 = -10log10(p/(1-p)) 【老版本v1.4以前】

Q(sanger)=-10*log10(p); 
p是base call不正确的概率，越小越好；而质量分数则越高越好。
p=0.05对应的质量得分为Q=约13


Phred quality scores are logarithmically linked to error probabilities
PHRED QUALITY SCORE/	PROBABILITY OF INCORRECT BASE CALL/	BASE CALL ACCURACY
10/	1 in 10/	90 %
20	1 in 100	99 %
30	1 in 1000	99.9 %
40	1 in 10000	99.99 %
50	1 in 100000	99.999 %

从Illumina 1.8开始，质量分数开始使用Sanger格式(Phred+33)。
S - Sanger  Phred+33,  raw reads typically (0, 40), Sanger(Phred+33, 33 to 73)
L - Illumina 1.8+ Phred+33,  raw reads typically (0, 41), 加33后是(33,74)


对应到到该仪器版本所采用过的phred标准，对应的ascall码范围求得整数质量分数值



(2)附录：质量分数和ascall码的转化

1)js版
求字符的ascii编号: 'K'.charCodeAt(0) //75

求ascii编号对应的字符: String.fromCharCode(0+33) //"!"
String.fromCharCode(30+33) //"?"


2)python版
c="K"
a=33
print( c + " 的ASCII 码为", ord(c)) #K 的ASCII 码为 75
print( a , " 对应的字符为", chr(a)) #33  对应的字符为 !

ord(',')-33 #11





3.fastq文件格式转换
格式转换：
Biopython version 1.51 onwards (interconverts Sanger, Solexa and Illumina 1.3+)
EMBOSS version 6.1.0 patch 1 onwards (interconverts Sanger, Solexa and Illumina 1.3+)
BioPerl version 1.6.1 onwards (interconverts Sanger, Solexa and Illumina 1.3+)
BioRuby version 1.4.0 onwards (interconverts Sanger, Solexa and Illumina 1.3+)
BioJava version 1.7.1 to 1.8.x (interconverts Sanger, Solexa and Illumina 1.3+)
MAQ can convert from Solexa to Sanger (use this patch to support Illumina 1.3+ files).
fastx_toolkit The included fastq_quality_converter program can convert Illumina to Sanger






========================================
.vcf file - Variant Call Format 多样性识别格式
----------------------------------------

1.VCF是用于描述SNP，INDEL和SV结果的文本文件。在GATK软件中得到最好的支持，当然SAMtools得到的结果也是VCF格式，和GATK的VCF格式有点差别。


https://en.wikipedia.org/wiki/Variant_Call_Format
The Variant Call Format (VCF) specifies the format of a text file used in bioinformatics for storing gene sequence variations.
vcf是生物信息中说明短基因序列多样性的文本文件格式。

The format has been developed with the advent of large-scale genotyping and DNA sequencing projects, such as the 1000 Genomes Project. 
这个格式是随着大规模基因分型，以及像1000基因组计划等DNA测序工程而产生的。

Existing formats for genetic data such as General feature format (GFF) stored all of the genetic data, much of which is redundant because it will be shared across the genomes. 
现有基因数据格式，比如基因特征格式gff保存了基因全部数据，多数信息是冗余的，因为基因组内共享这些序列。

By using the variant call format only the variations need to be stored along with a reference genome.


2.vcf格式简介：https://blog.csdn.net/VincentLuo91/article/details/72641934
VCF文件分为两部分内容：以“#”开头的注释部分；没有“#”开头的主体部分。


A PDF of the v4.1 spec is http://samtools.github.io/hts-specs/VCFv4.1.pdf
A PDF of the v4.2 spec is http://samtools.github.io/hts-specs/VCFv4.2.pdf




例子文件：
##fileformat=VCFv4.0
##fileDate=20110705
##reference=1000GenomesPilot-NCBI37
##phasing=partial
##INFO=<ID=NS,Number=1,Type=Integer,Description="Number of Samples With Data">
##INFO=<ID=DP,Number=1,Type=Integer,Description="Total Depth">
##INFO=<ID=AF,Number=.,Type=Float,Description="Allele Frequency">
##INFO=<ID=AA,Number=1,Type=String,Description="Ancestral Allele">
##INFO=<ID=DB,Number=0,Type=Flag,Description="dbSNP membership, build 129">
##INFO=<ID=H2,Number=0,Type=Flag,Description="HapMap2 membership">
##FILTER=<ID=q10,Description="Quality below 10">
##FILTER=<ID=s50,Description="Less than 50% of samples have data">
##FORMAT=<ID=GQ,Number=1,Type=Integer,Description="Genotype Quality">
##FORMAT=<ID=GT,Number=1,Type=String,Description="Genotype">
##FORMAT=<ID=DP,Number=1,Type=Integer,Description="Read Depth">
##FORMAT=<ID=HQ,Number=2,Type=Integer,Description="Haplotype Quality">
#CHROM POS    ID        REF  ALT     QUAL FILTER INFO                              FORMAT      Sample1        Sample2        Sample3
2      4370   rs6057    G    A       29   .      NS=2;DP=13;AF=0.5;DB;H2           GT:GQ:DP:HQ 0|0:48:1:52,51 1|0:48:8:51,51 1/1:43:5:.,.
2      7330   .         T    A       3    q10    NS=5;DP=12;AF=0.017               GT:GQ:DP:HQ 0|0:46:3:58,50 0|1:3:5:65,3   0/0:41:3
2      110696 rs6055    A    G,T     67   PASS   NS=2;DP=10;AF=0.333,0.667;AA=T;DB GT:GQ:DP:HQ 1|2:21:6:23,27 2|1:2:0:18,2   2/2:35:4
2      130237 .         T    .       47   .      NS=2;DP=16;AA=T                   GT:GQ:DP:HQ 0|0:54:7:56,60 0|0:48:4:56,51 0/0:61:2
2      134567 microsat1 GTCT G,GTACT 50   PASS   NS=2;DP=9;AA=G                    GT:GQ:DP    0/1:35:4       0/2:17:2       1/1:40:3
chr1    45796269        .       G       C
chr1    45797505        .       C       G
chr1    45798555        .       T       C
chr1    45798901        .       C       T
chr1    45805566        .       G       C
chr2    47703379        .       C       T
chr2    48010488        .       G       A
chr2    48030838        .       A       T
chr2    48032875        .       CTAT    -
chr2    48032937        .       T       C
chr2    48033273        .       TTTTTGTTTTAATTCCT       -
chr2    48033551        .       C       G
chr2    48033910        .       A       T
chr2    215632048       .       G       T
chr2    215632125       .       TT      -
chr2    215632155       .       T       C
chr2    215632192       .       G       A
chr2    215632255       .       CA      TG
chr2    215634055       .       C       T



3. 怎么解释Variation
CHROM 和 POS：代表参考序列名和variant的位置；如果是INDEL的话，位置是INDEL的第一个碱基位置。

ID：variant的ID。比如在dbSNP中有该SNP的id，则会在此行给出；若没有，则用’.'表示其为一个novel variant。

REF 和 ALT：参考序列的碱基 和 Variant的碱基。

QUAL：Phred格式(Phred_scaled)的质量值，表 示在该位点存在variant的可能性；该值越高，则variant的可能性越大；计算方法：Phred值 = -10 * log (1-p) p为variant存在的概率; 通过计算公式可以看出值为10的表示错误概率为0.1，该位点为variant的概率为90%。

FILTER：使用上一个QUAL值来进行过滤的话，是不够的。GATK能使用其它的方法来进行过滤，过滤结果中通过则该值为”PASS”;若variant不可靠，则该项不为”PASS”或”.”。

INFO： 这一行是variant的详细信息，内容很多，以下再具体详述。

FORMAT 和 NA12878：这两行合起来提供了’NA12878′这个sample的基因型的信息。’NA12878′代表这该名称的样品，是由BAM文件中的@RG下的 SM 标签决定的。






========================================
bed文件 - Browser Extensible Data 浏览器扩展数据文件
----------------------------------------
http://bedtools.readthedocs.io/en/latest/content/tools/window.html

https://genome.ucsc.edu/FAQ/FAQformat.html#format1

BED (Browser Extensible Data) format provides a flexible way to define the data lines that are displayed in an annotation track. BED lines have three required fields and nine additional optional fields. The number of fields per line must be consistent throughout any single set of data in an annotation track. The order of the optional fields is binding: lower-numbered fields must always be populated if higher-numbered fields are used.


The first three required BED fields are:
前三列是必须的：
1. chrom染色体 - The name of the chromosome (e.g. chr3, chrY, chr2_random) or scaffold (e.g. scaffold10671).
2. chromStart起始位置 - The starting position of the feature in the chromosome or scaffold. The first base in a chromosome is numbered 0.
3. chromEnd结束位置 - The ending position of the feature in the chromosome or scaffold. The chromEnd base is not included in the display of the feature. For example, the first 100 bases of a chromosome are defined as chromStart=0, chromEnd=100, and span the bases numbered 0-99.
feature在染色体上终止位置。染色体上前100个碱基片段的位置位置标记为：chromStart=0, chromEnd=100。 实际上，第100个碱基不属于当前片段中，当前片段的碱基应该是0-99。所以在BED文件中，起始位置从0开始，终止位置从1开始。




The 9 additional optional BED fields are:
还有9列可选项
4. name名字 - Defines the name of the BED line. This label is displayed to the left of the BED line in the Genome Browser window when the track is open to full display mode or directly to the left of the item in pack mode.
5. score打分 - A score between 0 and 1000. If the track line useScore attribute is set to 1 for this annotation data set, the score value will determine the level of gray in which this feature is displayed (higher numbers = darker gray). This table shows the Genome Browser's translation of BED score values into shades of gray:
shade	 	 	 	 	 	 	 	 	 
score in range  	≤ 166	167-277	278-388	389-499	500-611	612-722	723-833	834-944	≥ 945

6. strand正义反义链 - Defines the strand - either '+' or '-'.

# 一般文件也就到这里了。



7. thickStart - The starting position at which the feature is drawn thickly (for example, the start codon in gene displays). When there is no thick part, thickStart and thickEnd are usually set to the chromStart position.
8. thickEnd - The ending position at which the feature is drawn thickly (for example, the stop codon in gene displays).


9. itemRgb - An RGB value of the form R,G,B (e.g. 255,0,0). If the track line itemRgb attribute is set to "On", this RBG value will determine the display color of the data contained in this BED line. NOTE: It is recommended that a simple color scheme (eight colors or less) be used with this attribute to avoid overwhelming the color resources of the Genome Browser and your Internet browser.
R,G,B (e.g. 255,0,0)值，当track的itemRgb属性 设置为 "On"，BED的行会显示颜色.(见下例)

10. blockCount - The number of blocks (exons) in the BED line.
11. blockSizes - A comma-separated list of the block sizes. The number of items in this list should correspond to blockCount.
12. blockStarts - A comma-separated list of block starts. All of the blockStart positions should be calculated relative to chromStart. The number of items in this list should correspond to blockCount.

bed文件是0based坐标系统: In BED files with block definitions, the first blockStart value must be 0, so that the first block begins at chromStart. Similarly, the final blockStart position plus the final blockSize value must equal chromEnd. Blocks may not overlap.





# Example 1: BED文件示例
track name=pairedReads description="Clone Paired Reads" useScore=1
chr22 1000 5000 cloneA 960 + 1000 5000 0 2 567,488, 0,3512
chr22 2000 6000 cloneB 900 - 2000 6000 0 2 433,399, 0,3601





# Example 2: itemRgb 添加颜色
browser position chr7:127471196-127495720
browser hide all
track name="ItemRGBDemo" description="Item RGB demonstration" visibility=2 itemRgb="On"
chr7    127471196  127472363  Pos1  0  +  127471196  127472363  255,0,0
chr7    127472363  127473530  Pos2  0  +  127472363  127473530  255,0,0
chr7    127473530  127474697  Pos3  0  +  127473530  127474697  255,0,0
chr7    127474697  127475864  Pos4  0  +  127474697  127475864  255,0,0
chr7    127475864  127477031  Neg1  0  -  127475864  127477031  0,0,255
chr7    127477031  127478198  Neg2  0  -  127477031  127478198  0,0,255
chr7    127478198  127479365  Neg3  0  -  127478198  127479365  0,0,255
chr7    127479365  127480532  Pos5  0  +  127479365  127480532  255,0,0
chr7    127480532  127481699  Neg4  0  -  127480532  127481699  0,0,255

# 上面信息在the Genome Browser展示结果，查看 BED itemRgb; 其中Pos 和Neg 分别由一种不同的颜色标记。
http://www.genome.ucsc.edu/cgi-bin/hgTracks?db=hg19&virtMode=0&position=chr7%3A127471196-127495720&hgsid=730966987_AnyMOyiWgkvvHndSdQ5bV5XqUatg




$ cat A.bed
chr1  10000  20000  A.forward  1  +
chr1  10000  20000  A.reverse  1  -

$ cat B.bed
chr1  1000   8000   B1
chr1  24000  32000  B2

$ bedtools window -a A.bed -b B.bed -l 5000 -r 1000 -sw
chr1  10000  20000  A.forward  1  +  chr1  1000   8000   B1
chr1  10000  20000  A.reverse  1  -  chr1  24000  32000  B2

基因组浏览器：
https://genome.ucsc.edu/cgi-bin/hgTracks?org=human&position=chr7&hgt.customText=http://genome.ucsc.edu/goldenPath/help/ColorByStrandDemo.txt





========================================
BED detail format(bed 扩展版)
----------------------------------------

This is an extension of BED format. BED detail uses the first 4 to 12 columns of BED format, plus 2 additional fields that are used to enhance the track details pages. The first additional field is an ID, which can be used in place of the name field for creating links from the details pages. The second additional field is a description of the item, which can be a long description and can consist of html, including tables and lists.
使用4-12列的bed格式，再加上2个额外字段。第一个ID，用于name字段，用于创建详情页。第二个额外字段是条目的描述，可以是包含html(含表格和列表)的长描述。


Requirements for BED detail custom tracks are: fields must be tab-separated, "type=bedDetail" must be included in the track line, and the name and position fields should uniquely describe items so that the correct ID and description will be displayed on the details pages.
必须是tab分割的字段。



Example:
This example uses the first 4 columns of BED format, but up to 12 may be used. Click here to view this track in the Genome Browser.
本例中使用了bed格式的前4列，最多可以使用前12列。


chr start end ID score description

track name=HbVar type=bedDetail description="HbVar custom track" db=hg19 visibility=3 url="http://globin.bx.psu.edu/cgi-bin/hbvar/query_vars3?display_format=page&mode=output&id=$$"
chr11	5246919	5246920	Hb_North_York	2619	Hemoglobin variant
chr11	5255660	5255661	HBD c.1 G>A	2659	delta0 thalassemia
chr11	5247945	5247946	Hb Sheffield	2672	Hemoglobin variant
chr11	5255415	5255416	Hb A2-Lyon	2676	Hemoglobin variant
chr11	5248234	5248235	Hb Aix-les-Bains	2677	Hemoglobin variant 





========================================
.cel - Affymetrix CEL Data File Format 芯片数据
----------------------------------------
http://media.affymetrix.com/support/developer/powertools/changelog/gcos-agcc/cel.html

Description
The CEL file stores the results of the intensity calculations on the pixel values of the DAT file. This includes an intensity value, standard deviation of the intensity, the number of pixels used to calculate the intensity value, a flag to indicate an outlier as calculated by the algorithm and a user defined flag indicating the feature should be excluded from future analysis. The file stores the previously stated data for each feature on the probe array. The information below will describe the following versions:

CEL文件保存了DAT文件中像素值的强度计算结果。包括强度值、标准误差、计算强度值的像素点个数、算法计算的异常flag值、用户自定义的表示未来分析中应该排除的flag。文件保存了此前描述的关于探针数组的数据。如下信息将描述这些版本。

Version 3 is generated by the MAS software. This was also known as the ASCII version.
版本3是MAS软件产生的。这也被叫做ASCII版本。

Version 4 is generated by the GCOS software. This was also known as the binary or XDA version.
版本4是GCOS软件产生的。这也被叫做二进制或者XDA版本。

Command Console version 1 is generated by the Command Console software. This is stored in the Command Console "generic" data file format.
命令行版本1是命令行软件产生的。这被保存在命令行“generic”数据文件格式中。



========================================
sam格式和samtools
----------------------------------------
1.【文件格式】SAM/BAM and related specifications
https://en.wikipedia.org/wiki/SAM_(file_format)
http://samtools.github.io/hts-specs/
https://samtools.github.io/hts-specs/SAMv1.pdf


2.sam格式是头部，加上正文，正文部分强制规定的有11列，外加可选的额外列。

Col	Field	Type	Brief Description
1	QNAME	String	Query template NAME
2	FLAG	Int	bitwise FLAG
3	RNAME	String	References sequence NAME
4	POS	Int	1- based leftmost mapping POSition
5	MAPQ	Int	MAPping Quality
6	CIGAR	String	CIGAR String
7	RNEXT	String	Ref. name of the mate/next read
8	PNEXT	Int	Position of the mate/next read
9	TLEN	Int	observed Template LENgth
10	SEQ	String	segment SEQuence
11	QUAL	String	ASCII of Phred-scaled base QUALity+33

查看命令
$ samtools view hg19_mm10/c01_ROW02_Aligned.sortedByCoord.out.bam|head -n 200|awk '{print $5}'|sort|uniq -c


主体部分有11个主列和1个可选列
(1)QNAME	比对的序列名称	例如：M04650:84:000000000-B837R:1:1101:22699:1759（一条测序reads的名称）
(2)FLAG	Bwise FLAG（表明比对类型：paring，strand，mate strand等）	例如：99
数值结果如下：
1（1）该read是成对的paired reads中的一个
2（10）paired reads中每个都正确比对到参考序列上
4（100）该read没比对到参考序列上
8（1000）与该read成对的matepair read没有比对到参考序列上
16（10000）该read其反向互补序列能够比对到参考序列
32（100000）与该read成对的matepair read其反向互补序列能够比对到参考序列
64（1000000）在paired reads中，该read是与参考序列比对的第一条
128（10000000）在paired reads中，该read是与参考序列比对的第二条
256（100000000）该read是次优的比对结果
512（1000000000）该read没有通过质量控制
1024（10000000000）由于PCR或测序错误产生的重复reads
2048（100000000000）补充匹配的read
具体的flag值的解释，可以参考samtools软件提供的结果

通过这个和可以直接推断出匹配的情况。假如说标记不是以上列举出的数字，比如说83=（64+16+2+1），就是这几种情况值和。

//todo 那么0是什么意思？

$ samtools view dAdapter_CutA_c16_ROW17.fq_Aligned.sortedByCoord.out.bam |awk '{print $2}' |sort|uniq -c
 581212 0 #star的Flag=0手动检查，看到是匹配到了正链上了
 393011 16 #flag=16 表示匹配到负链上了
 177445 256 #(舍弃)256 次优比对
 127815 272 #(舍弃)256+16 次优比对到负链
#行数 flag

# flag 结合 MAPQ一起看，发现MAPQ=255的最优比对对应的flag只有0和16两种取值(对应着正负链)。
$ samtools view dAdapter_CutA_c16_ROW17.fq_Aligned.sortedByCoord.out.bam |awk '{print $2"\t"$5}' |sort|uniq -c
   9089 0       0
  17997 0       1
 477741 0       255
  76385 0       3
  10008 16      0
  17995 16      1
 327183 16      255
  37825 16      3
  54254 256     0
  46198 256     1
  76993 256     3
  51056 272     0
  39542 272     1
  37217 272     3
#行数 flag MAPQ



(3)RENAME	比对上的参考序列名	例如：chr1 染色体名字
表示read比对的那条序列的序列名称（名称与头部的@SQ相对应），如果这列是“*”，可以认为这条read没有比对上的序列，则这一行的第四，五，八，九 列是“0”，第六，七列与该列是相同的表示方法



(4)POS	1-Based的比对上的最左边的定位	例如：124057649
表示read比对到RNAME这条序列的最左边的位置，如果该read能够完全比对到这条序列（CIGAR string为M）则这个位置是read的第一个碱基比对的位置，如果该read的反向互补序列比对到这条序列，则这个位置是read的反向互补序列的第一个碱基比对的位置，所以无论该read是正向比对到该序列，或是其反向互补序列比对到该序列，比对结果均是最左端的比对位置


(5)MAPQ	比对质量	例如：255
表示为mapping的质量值，mapping Quality, It equals -10log10Pr{mapping position is wrong}, rounded to the nearest integer, A value 255 indicates that the mapping quality is not available. 该值的计算方法是mapping的错误率的-10log10值，之后四舍五入得到的整数，如果值为255表示mapping值是不可用的，如果是unmapped read则MAPQ为0，一般在使用bwa mem或bwa aln（bwa 0.7.12-r1039版本）生成的sam文件，第五列为60表示mapping率最高，一般结果是这一列的数值是从0到60，且0和60这两个数字出现次数最多

STAR出来的bam结果255最多。
$ samtools view dAdapter_CutA_c16_ROW17.fq_Aligned.sortedByCoord.out.bam |awk '{print $5}' |sort|uniq -c 
 124407 0
 121732 1
 804924 255
 228420 3



#sam文件说A value 255 indicates that the mapping quality is not available.
但是STAR说明书说到： The mapping quality MAPQ (column 5) is 255 for uniquely mapping reads, and int(-10*log10(1-1/Nmap)) for multi-mapping reads.
http://zjuwhw.lofter.com/post/1d209faf_7366624
so, if Nmap == 1, MAPQ = inf. In the STAR, the MAPQ is 255, which means uniquely mapped.
If Nmap == 2, MAPQ = 3, which means that there are two primary alignments for this read.
If Nmap ==3 or 4, MAPQ = 1, which means that there are 3 or 4 primary alignments for this read.
If Nmap >= 5, MAPQ = 0.





#tophat1是255,tophat2是50；http://blog.sina.com.cn/s/blog_86c8fc120102uz5o.html
在需要用到uniquely mapped reads时，可以参考上表，为了保险起见，NH这个tag是统一的，不随tophat版本变化。
注意：如果是直接grep NH:i:1的话，一定要用grep "NH:i:1\b"，否则会把NH:i:10这类的也抓下来！（切身教训）

另外，注意unmapped.bam 的MAPQ为255，这和其他软件的MAPQ值都不太一样，注意后续质控软件统计的方法，以免出问题。
例如，STAR 的比对unique 比对的MAPQ为255，和Tophat不一样。




(6)CIGAR	Extended CIGAR string（操作符：MIDNSHP）比对结果信息；匹配碱基数，可变剪接等	例如：87M
CIGAR string，可以理解为reads mapping到第三列序列的mapping状态，对于mapping状态可分为以下几类：

M：alignment match (can be a sequence match or mismatch)
表示read可mapping到第三列的序列上，则read的碱基序列与第三列的序列碱基相同，表示正常的mapping结果，M表示完全匹配，但是无论reads与序列的正确匹配或是错误匹配该位置都显示为M

I：insertion to the reference
表示read的碱基序列相对于第三列的RNAME序列，有碱基的插入

D：deletion from the reference
表示read的碱基序列相对于第三列的RNAME序列，有碱基的删除

N：skipped region from the reference
表示可变剪接位置

P：padding (silent deletion from padded reference)
S：soft clipping (clipped sequences present in SEQ)
H：hard clipping (clipped sequences NOT present in SEQ)
clipped均表示一条read的序列被分开，之所以被分开，是因为read的一部分序列能匹配到第三列的RNAME序列上，而被分开的那部分不能匹配到RNAME序列上。
"="表示正确匹配到序列上
"X"表示错误匹配到序列上

而H只出现在一条read的前端或末端，但不会出现在中间，S一般会和H成对出现，当有H出现时，一定会有一个与之对应的S出现


(7)MRNM	相匹配的另外一条序列，比对上的参考序列名。
实际上就是mate比对到的染色体号，若是没有mate，则是*；
(8)MPOS	1-Based leftmost Mate Position	（相比于MRNM列来讲意思和POS差不多）	例如：124057667
第八列：mate position，mate比对到参考序列上的第一个碱基位置，若无mate,则为0；
(9)ISIZE	插入片段长度	例如：200
ISIZE，Inferred fragment size.详见Illumina中paired end sequencing 和 mate pair sequencing，是负数，推测应该是两条read之间的间隔(待查证)，若无mate则为0；

(10)SEQ	Sequence，就是read的碱基序列，如果是比对到互补链上则是reverse completed   eg.CGTTTCTGTGGGTGATGGGCCTGAGGGGCGTTCTCN 

(11)QUAL	比对序列的质量（ASCII-33=Phred base quality）reads碱基质量值	例如：-8CCCGFCCCF7@E-


(12)12列及之后是可选的列，以TAG：TYPE：VALUE的形式提供额外的信息
比较重要的是 NH:i:1 表示number of hit 是整数1，就是uniq mapping.












========================================
----------------------------------------



========================================
----------------------------------------


========================================
----------------------------------------



========================================
----------------------------------------



========================================
----------------------------------------



========================================
----------------------------------------


========================================
----------------------------------------



========================================
----------------------------------------



========================================
----------------------------------------



========================================
----------------------------------------


========================================
----------------------------------------



========================================
----------------------------------------



========================================
----------------------------------------



========================================
----------------------------------------


