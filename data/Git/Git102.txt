git常用场景


版本管理三国志 (CVS, Subversion, git)解答了为什么选择git？
http://www.cnblogs.com/vamei/archive/2013/02/21/2918069.html


========================================
文整理了git操作中常用的命令，使用场景及命令持续补充中。。。
----------------------------------------

一. 初始化一个Git仓库，添加文件到该仓库
操作步骤：
1. 创建一个文件夹gitTest，进入该文件夹，执行git init命令。
2. 添加文件到git仓库，使用git add <file>添加，git commit提交。

二. 查看提交记录
操作步骤：
1. 进入gitTest文件夹，执行git log命令，如果内容过多可以采用git log —pretty=oneline

三. 如何回退到指定版本
HEAD^表示上一个版本，HEAD^^表示上上个版本，HEAD~100，表示上100个版本
操作步骤：
1.进入gitTest文件夹，执行git log命令，查看commit信息，得到commit命令的Id,
执行 git reset --hard <commitId>就可以穿越到指定版本。

四. 如何查看命令的历史
操作步骤：
1. 执行git reflog查看命令历史

五. 当你在工作区改错了文件，想直接丢弃工作区的修改？
操作步骤：
1. 执行命令git checkout — <file>，丢弃文件的修改

六. 当你不只是改错了文件，而且还添加到了暂存区，如果想丢弃修改？
操作步骤：
1. 执行命令git reset --HEAD <file>，从暂存区删除
2. 执行命令git checkout — <file>，丢弃文件的修改



========================================
git 查看远程分支、本地分支、删除本地分支
----------------------------------------
http://blog.it985.com/753.html
1 查看远程分支
  $ git branch -r #只有远程分支
  $ git branch -a #远程和本地分支。前面带*号的代表你当前工作目录所处的分支
2 查看本地分支
  $ git branch
3 创建分支
   git branch test
   或者
   git checkout -b test #创建test分支并切换到该分支
4 切换分支到test
  $ git checkout test
5 删除本地分支   
  $ git branch -d test
  $ git branch #再查看分支，该分支已经删除
6 拉取远程分支并创建本地分支
http://firecloudphp.blog.163.com/blog/static/25082207020171973136710/
方法一:git checkout -b 本地分支名x origin/远程分支名x
使用该方式会在本地新建分支x，并自动切换到该本地分支x。

方式二:git fetch origin 远程分支名x:本地分支名x
使用该方式会在本地新建分支x，但是不会自动切换到该本地分支x，需要手动checkout。




========================================
使用Git比较本地分支版本和远程版本的不同之处?
----------------------------------------
1.假定远端库名为 origin, 你要比较的本地分支为 test, 远端分支为 xxx
# 获取远端库最新信息
$ git fetch origin

# 做diff
$ git diff test origin/xxx

2.合并远程分支到本地分支
如果远端在其他电脑上更新过并push过，则本地是落后的，常规push会失败。
需要先获取远端代码
$ git fetch origin

然后将分支路径上的代码拉到本地代码。没有冲突的自动更新，有冲突的我们单方面处理冲突
$ git merge origin/xxx 

$ git status
会显示分别修改的文件，和同时修改的文件，
	both modified:   devLog.txt
对于后者需要手动处理冲突，然后再git add和git commit，这时候就可以正常push了。



========================================
更新远程代码到本地仓库【推荐】
----------------------------------------
http://firecloudphp.blog.163.com/blog/static/250822070201714104426191/


方式一
1. 查看远程仓库
$ git remote -v
eoecn   https://github.com/eoecn/android-app.git (fetch)
eoecn   https://github.com/eoecn/android-app.git (push)
origin  https://github.com/com360/android-app.git (fetch)
origin  https://github.com/com360/android-app.git (push)
su@SUCHANGLI /e/eoe_client/android-app (master)
从上面的结果可以看出，远程仓库有两个，一个是eoecn，一个是origin

2 ,从远程获取最新版本到本地
$ git fetch origin master
From https://github.com/com360/android-app
 * branch            master     -> FETCH_HEAD
su@SUCHANGLI /e/eoe_client/android-app (master)
$ git fetch origin master 这句的意思是：从远程的origin仓库的master分支下载代码到本地的origin master

3. 比较本地的仓库和远程参考的区别
$ git log -p master.. origin/master
su@SUCHANGLI /e/eoe_client/android-app (master)
因为我的本地仓库和远程仓库代码相同所以没有其他任何信息

4. 把远程下载下来的代码合并到本地仓库，远程的和本地的合并
$ git merge origin/master
Already up-to-date.
su@SUCHANGLI /e/eoe_client/android-app (master)
我的本地参考代码和远程代码相同，所以是Already up-to-date

以上的方式有点不好理解，大家可以使用下面的方式，并且很安全





方式二
1.查看远程分支，和上面的第一步相同

2. 从远程获取最新版本到本地
$ git fetch origin master:temp
From https://github.com/com360/android-app
 * [new branch]      master     -> temp
su@SUCHANGLI /e/eoe_client/android-app (master)
git fetch origin master:temp 这句命令的意思是：从远程的origin仓库的master分支下载到本地并新建一个分支temp

3. 比较本地的仓库和远程参考的区别
$ git diff temp
su@SUCHANGLI /e/eoe_client/android-app (master)
命令的意思是：比较master分支（个人理解为“本地master分支”）和temp分支的不同
由于我的没有区别就没有显示其他信息

4. 合并temp分支到master分支（个人理解为“本地master分支”）
$ git merge temp
Already up-to-date.
su@SUCHANGLI /e/eoe_client/android-app (master)
由于没有区别，所以显示Already up-to-date.
合并的时候可能会出现冲突，有时间了再把如何处理冲突写一篇博客补充上。
5.如果不想要temp分支了，可以删除此分支
$ git branch -d temp
Deleted branch temp (was d6d48cc).
su@SUCHANGLI /e/eoe_client/android-app (master)
如果该分支没有合并到主分支会报错，可以用以下命令强制删除git branch -D <分支名>

总结：方式二更好理解，更安全。 
对于pull也可以更新代码到本地，相当于fetch+merge，多人协作的话不够安全。




========================================
|-- 合并2个终端分支【亲测】: 笔记本假期更新，怎么添加放假前PC更新?
----------------------------------------
因2020年上半年疫情影响，学校一体机放假前更新了 south 分支和 笔记本回家添加的最新的 shenZhuang 分支并不一致，俩的主分支都是master分支。

目前需要在 笔记本 上 shenZhuang 工作，需要把 south 同步过来。


之前已经把south分支推到github上，再在 笔记本上操作。


1.拉远程分支到本地
$ git fetch origin south 

教训: 这里是不是应该拉远程分支，同时建立对应的本地分支呢？



############ 策略1: 
2A. 比较本地的仓库和远程参考的区别
### git diff branchA remoteB/branchB #参考
## git diff origin/south shenZhuang #以后者为比较基准

实际用的是和当前状态比， 
$ git diff origin/south
然后参照github页面，修改一处，重新运行该语句，比较下一个不同。

要修改的太多了。反过来吧。



############ 策略2:
2B. 笔记本刚做变动，我比较熟悉，所以切换到 south 分支做比较更方便。
$ git checkout origin/south 
$ git diff shenZhuang #查看shenZhuang相对于当前版本(south)的变动，
+是当前版本(south)新添加的；
-是当前版本(south)没有的，需要手动添加回来;


bug(1)
git diff shenZhuang data/R/R03_linear_algebra.txt
当前git没有记录的新文件，现在有了，为什么和旧记录diff时找不到新文件？

需要在版本和路径之间加双减号:
$ git diff shenZhuang -- data/R/R03_linear_algebra.txta

好像整体比较时，还是没啥区别。



3. 出现临时分支了，怎么合并？
现在在一个临时分支上，
$ git branch
 (HEAD detached at origin/south)
#
1)在当前临时分支上提交，并commit
git add .
git commit -m 'temp(2020-3-19)'

2)查看已经提交的分支hash值
git reflog show HEAD@{now} -10

或
$ git log -n 3
commit df36db8f6f5db909b1a67f94b09dd62a2ab5911d (HEAD)
Author: jimmymall Note <jimmymall@163.com>
Date:   Thu Mar 19 18:06:55 2020 +0800

    temp(2020-3-19)
#

3) 新建分支，关联起来刚才的hash值
git branch notebook df36db8 

4) 切换分支
git checkout notebook
发现刚才合并的一切都在。

5) 可以合并notebook分支到master分支了。
git checkout master
git merge --no-ff notebook -m 'mergeToMaster'





========================================
git克隆远程项目并创建本地对应分支
----------------------------------------
1.克隆远程库，只有master分支
$ git clone git@github.com:miostudio/bioMooc.com.git
$ git branch 

2.查看远程分支 
$ git branch -r
  origin/HEAD -> origin/master
  origin/gh-pages
  origin/master

3.建立本地对应分支
git checkout --track 或者 git checkout -b
如：
git checkout --track  origin/dev-xxx
git  checkout -b dev-xx  origin/dev-xxx

$ git checkout -b gh-pages origin/gh-pages
Branch gh-pages set up to track remote branch gh-pages from origin.
Switched to a new branch 'gh-pages'

4.建立分支后，默认会进到新建的分支里，如果想进去其他分支，可以通过
git checkout 加分支名切换
如:
git checkout master


========================================
怎么查一个文件谁修改过及修改时间？
----------------------------------------
1.git log --pretty=oneline 文件名 
查找 文件修订历史。列出一系列sha1号和评论。

2.git show 356f6def9d3fb7f3b9032ff5aa4b9110d4cca87e
查具体修改时间等信息。



========================================
git统计某一名开发者有效代码总行数以及历史删除、增加的总行数
----------------------------------------
1.代码量（按照行统计）
$ git log --author="jimmymall" --pretty=tformat: --numstat | gawk '{ add += $1 ; subs += $2 ; loc += $1 - $2 } END { printf "增加的行数:%s 删除的行数:%s 总行数: %s\n",add,subs,loc }'

增加的行数:12705 删除的行数:2343 总行数: 10362

该命令统计一名开发者在当前分支的历史上所作出的全部增加代码的行数量，已经删除过的总的代码行数量，以及最后该名开发者最终保留在分支中的代码总行数。
https://blog.csdn.net/zhangphil/article/details/79956706


$ git log --author="$(git config --get user.name)" --pretty=tformat: --numstat | gawk '{ add += $1 ; subs += $2 ; loc += $1 - $2 } END { printf "added lines: %s removed lines : %s total lines: %s\n",add,subs,loc }' -





2. 扫描 Log 单独统计每个人的增删行数加强版
$ git log --format='%aN' | sort -u | while read name; do echo -en "$name\t"; git log --author="$name" --pretty=tformat: --numstat | awk '{ add += $1; subs += $2; loc += $1 - $2 } END { printf "added lines: %s, removed lines: %s, total lines: %s\n", add, subs, loc }' -; done

Dawn    added lines: 3464, removed lines: 588, total lines: 2876
dawnEve added lines: 28663, removed lines: 2098, total lines: 26565
jimmy   added lines: 42551, removed lines: 4985, total lines: 37566
Jimmy   added lines: 53771, removed lines: 13383, total lines: 40388
jimmymall Note  added lines: 3, removed lines: 0, total lines: 3



3.统计文件夹内代码行数
$ cd file
$ find . -name "*.java" -or -name "*.html" -or -name ".css" -or -name "*.js" |xargs grep -v "^$"|wc -l




========================================
windows下git显示文件被修改，实际没有改动的问题解决办法
----------------------------------------

解决方案1：
在windows中的git bash中运行以下命令：
git config --global core.autocrlf true

https://blog.csdn.net/qq719365064/article/details/52775860



解决方案2：
https://blog.csdn.net/Winne_Shen/article/details/80511480
1.问题：从git上拉取服务端代码，然后只修改了一处地方，准备提交时，用diff软件查看，却发现整个文件都被修改了。这是git自动转换换行符导致的问题。 

2.原因
不同操作系统使用的换行符是不一样的。Unix/Linux使用的是LF，Mac后期也采用了LF，但Windows一直使用CRLF【回车(CR, ASCII 13, \r) 换行(LF, ASCII 10, \n)】作为换行符。而git入库的代码采用的是LF格式，它考虑到了跨平台协作的场景，提供了“换行符自动转换”的功能：如果在Windows下安装git，在拉取文件时，会自动将LF换行符替换为CRLF；在提交时，又会将CRLF转回LF。但是这个转换是有问题的：有时提交时，CRLF转回LF可能会不工作，尤其是文件中出现中文字符后有换行符时。 


3.解决方案
(1).禁用git的自动换行功能： 
在本地路径C:\ Users\ [用户名] \ .gitconfig 下修改git配置[core]，如果没有就直接添加上去：

[core]
	autocrlf = false
	filemode = false
	safecrlf = true

git bash命令行也可以修改，最终也是修改.gitconfig配置文件： 分别执行：
git config --global core.autocrlf false
git config --global core.filemode false
git config --global core.safecrlf true

(2).配置IDE开发环境，将它的换行格式指定为LF，以android studio为例： 








========================================
gist.github.com 被墙无法访问解决办法
----------------------------------------
windows下 打开C:\Windows\System32\drivers\etc\hosts文件   
编辑器打开，在最后行添加一行:

192.30.253.118 gist.github.com

保存。
over~



========================================
推送到新库失败的几个原因？
----------------------------------------
终极测试方法
$ ssh -T git@github.com
Hi DawnEve! You've successfully authenticated, but GitHub does not provide shell access.
表明连接成功!


1.可能没有设置用户名和邮箱，每个项目都要设置！
查看邮箱的方式
git show #第一行就是用户名和邮箱。
或
git config user.email

查看最近提交使用的用户名和邮箱
git log -n 5

设置有户名和邮箱
git config --global user.name "jimmy" //给自己起个用户名
git config --global user.email  "JimmyMall@live.com" //填写自己的邮箱





2.远端库名添加错了，先删掉
git remote rm origin

再重新添加
git remote add origin git@github.com:DawnEve/txtBlog.py.git

并覆盖式推送
git push -u origin master  #首次推送使用-u参数，以后的推送就不要加-u了。





3.可能ssh key没有设置正确



========================================
|-- 设置/重新设置 ssh key
----------------------------------------
(1)重新在git设置一下身份的名字和邮箱
git config --global user.name "yourname"
git config --global user.email "your@email.com"
这里的yourname必须与github的用户名一致
这里your@email.com必须与github登录邮箱一致

(2)删除.ssh文件夹下的known_hosts文件(该文件主要作用是域名解析)，id_rsa和id_rsa.pub文件。
C:\Users\admin\.ssh

(3)ssh-keygen -t rsa -C "your@email.com" #(填写github对应的邮箱)
一路回车即可，无需输入

(4)进入github设置界面
右上角头像点击，选择settings，
左边点击 SSH and GPG keys,
右上角点new SSH Key，
把 C:\Users\admin\.ssh下的 id_rsa.pub内容粘贴进去，title随便命名。

就可以push了。


https://www.cnblogs.com/youcong/p/11111397.html


========================================
GitHub Pages 的使用
----------------------------------------
1. GitHub Pages 支持从三个地方读取文件

docs/ 目录
master 分支
gh-pages 分支

推荐直接将文档放在 docs/ 目录下；
找到仓库的Settings设置页面，开启 GitHub Pages 功能并选择 master branch /docs folder 选项。






========================================
----------------------------------------



========================================
----------------------------------------


========================================
----------------------------------------

========================================
----------------------------------------



========================================
----------------------------------------

========================================
----------------------------------------



========================================
----------------------------------------


========================================
----------------------------------------

========================================
----------------------------------------

