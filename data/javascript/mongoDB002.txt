
MongoDB基础篇
当前版本：3.2.1

系统：Ubuntu1404(64bit)


视频：http://www.imooc.com/learn/295

课程须知
1、对数据库的概念有比较清晰的认识。 
2、了解一些简单的shell操作。

老师告诉你能学到什么？
1、了解mongoDB的特性 
2、掌握mongoDB的基本操作  
3、了解mongoDB在业务层的使用，并学会使用mongoDB来进行应用开发

========================================
为什么使用 MongoDB
----------------------------------------
1.学习目标：
概念：mongoDB,mongo,索引,集合,复制集,分片,数据均衡。

搭建：单机服务、具有冗余容错功能的复制集、搭建大规模数据集群、完整集群的自动部署。

使用：增删改查、索引的创建和使用、复杂的聚合查询、
	对数据集合进行分片，在不用分片之间维持数据均衡、
	数据备份与恢复、数据迁移
	
简单运维：
	部署MongoDB集群、
	处理常见故障
		单节点失效，如何恢复工作
		数据库意外被杀死如何进行数据恢复
		数据库发生拒绝服务时如何排查原因
		数据库磁盘快满时如何处理？

初级：背景知识、基本操作
中级：常见部署操作，简单运维
高级：介绍集群及大型集群的运维经验，及mongoDB的实现原理、常见问题及解决办法。

	如何运维一个上百T的数据库？
	如何维持一个几十个、上百个节点的数据库的均衡。

2.
有用的网站：
	mongoDb官网：www.mongodb.org	软件和文档，所有驱动的文档
	国内站：www.mongoing.com	讨论	docs.mongoing.com	中文文档的翻译
	github: https://github.com/mongodb  https://github.com/mongodb/mongo

3.
什么是数据库？
	按照需求对数据进行存储和查询。
4.	
数据库的分类：
	sql数据库：支持sql语言的数据库
		oracle,mysql...
	NoSql数据库：不支持sql语言的数据库
		Redis,mongoDB...
		Not only sql(悄悄放弃了sql)
5.
sql与NoSql数据库的区别？
	实时一致性		简单便捷
	事务		方便扩展
	多表联合查询	更好的性能

因为放弃了很多，所以失去了很多特性，但是有很多新特性。

6.为什么是mongoDB？
	1) 无数据结构限制
		没有表结构的概念，每条记录可以有完全不同的结构
		业务开发方便快捷
		sql数据库需要事先定义表结构再使用
		{name:'小明',sex:'男'}
		{name:'小红',address:'上海'}
		{name:'小红',home:[{'山东'},{'上海'}]}
	2)完全的索引支持
		redis的key-value只支持key查询
		hbase的单索引，二级索引需要自己实现
			单键索引，多键索引：{x:1, y:1}
			数组索引：['apple','lemon']
			全文索引："I am a little bird."(暂时不支持中文)
			地理位置索引：2D
	3)方便的冗余与扩展
		复制集保证数据安全
		分片扩展数据规模
		每个数据都是保存三份：1主2从
	4)良好的支持
		完善的文档
		齐全的驱动支持
	
7.
为什么要使用MongoDB
	JSON风格文件的形式，面向文档存储：数据存储
	对任何属性可索引
	复制和高可用性
	自动分片
	丰富的查询
	快速就地更新
	MongoDB的专业技术支持
	"因为NodeJS,所以学MongoDB"

应该在哪里使用MongoDB？
	大数据
	内容管理和交付
	移动和社交基础设施
	用户数据管理
	数据平台
	
========================================
Linux下安装MongoDB  
----------------------------------------
环境
mongoDB环境：linux64bit
mongoDB版本：3.2.1最新版
ssh工具：xshell
文本编辑器：vim/notepad++/sublime text2

1.下载编译好的二进制包
到官网https://www.mongodb.org/downloads#production找下载链接，然后使用curl命令下载
$curl https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-ubuntu1404-3.2.1.tgz > mongo.tgz 

2.解包
$tar xzf mongo.tgz 
如果没有安装curl 
先安装$sudo apt-get install curl 

改名字：mv mongodb-linux-x86_64-ubuntu1404-3.2.1/ mongodb

4.移动位置
$sudo mv mongodb /usr/lib/

5.
主要命令
mongod	实现mongodb的主程序，用于数据库部署
mongo 用来连接mongodb数据库的客户端，对mongodb的所有操作都要用mongo来连接服务器
mongoimport/mongoexport	数据库的导入导出
mongodump/mongorestore	导入导出二进制，用于数据的备份与恢复
mongooplog	oplog用于日志的回放。mongodb的复制集。
mongostat	查看mongodb的状态。







http://blog.csdn.net/njchenyi/article/details/19045763#t0

========================================
----------------------------------------
http://www.imooc.com/video/5939


tar zxvf mongodb-linux-x86_64-2.x.x.tgz
cd /usr/mongodb-linux-x86_64-2.x.x/bin
创建链接
ln -s /usr/mongodb-linux-x86_64-2.x.x mongodb
但是在运行前，需要创建mongodb需要的存放数据和日志的目录：
sudo mkdir -p /data/db/journal
sudo chmod -R 777 /data/db/
启动mongodb server,-journal 代表要写日志，-maxConns=2400代表mongodb 可以接受2400个tcp连接，-rest代表可以允许客户端通过rest API访问mongdb server.
./mongod -journal -maxConns=2400 -rest
还可以使用参数—quiet启动可以指定安静模式减少记录的项目数，注意使用该参数必须要同时指定日志路径,比如：
—quiet —logpath /data/db/journal/mongdb.log


1.下载
到官网https://www.mongodb.org/downloads#production找下载链接，然后使用curl命令下载
$curl https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-ubuntu1404-3.2.1.tgz > mongo.tgz 

2.解包
$tar xzf mongo.tgz 
如果没有安装curl 
先安装$sudo apt-get install curl 

改名字：mv mongodb-linux-x86_64-ubuntu1404-3.2.1/ mongodb

4.移动位置
$sudo mv mongodb /usr/lib/

5.创建快捷方式: $sudo ln -s /usr/lib/mongodb/bin/ /usr/bin/mongodb
这样可以在命令行中使用：$mongodb访问数据库文件。


bsondump  mongodump    mongoimport  mongorestore  mongostat
mongo     mongoexport  mongooplog   mongos        mongotop
mongod    mongofiles   mongoperf    mongosniff


发现还是不能用。就使用
$ sudo apt-get install mongodb-clients

貌似应该安装server版。
//$ apt-get install mongodb-10gen=3.2.1
$ sudo apt-get install mongodb-server


步骤二：创建数据文件夹

默认情况下，MongoDB会在/data/db/这个文件夹存放数据，这个文件夹需要自己手动创建。 
通过如下方式创建：

$ sudo mkdir -p /data/db/ 
$ sudo chown `id -u` /data/db 
$ sudo chown -R mongodb:mongodb /data 
当然 可以 通过--dbpath 命令 指定MongoDB将数据存储到另外的目录中去。 


步骤三：让数据库运行起来

通过"pgrep mongo -l "查看进程是否已经启动
在终端输入"mongo"，然后回车进入数据库。


在控制台中： 
$ nohup ./mongodb-xxxxxxx/bin/mongod &
//nohup Run COMMAND, ignoring hangup signals.
//&：表示程序在后台运行

# $ ./mongodb-xxxxxxx/bin/mongo 

wjl@ubuntu:/usr/bin/mongodb$ ./mongo
MongoDB shell version: 3.2.1
connecting to: test
> db.foo.save({a:1,b:'sometest'})
Cannot use commands write mode, degrading to compatibility mode
WriteResult({ "nInserted" : 1 })
> db.foo.find()

结果是：
{ "_id" : ObjectId("56a02e3842cda05550224eb5"), "a" : 1, "b" : "sometest" }


不用./mongo，而是直接运行，发现是老版本的：
$ mongo
MongoDB shell version: 2.4.9
connecting to: test
>
需要卸载或者升级。
$ sudo apt-get upgrade mongodb



在Ubuntu下进行MongoDB安装步骤：
http://www.cnblogs.com/alexqdh/archive/2011/11/25/2263626.html



----
MongoDB README

Welcome to MongoDB!

COMPONENTS

  bin/mongod - The database process.
  bin/mongos - Sharding controller.
  bin/mongo  - The database shell (uses interactive javascript).

UTILITIES

  bin/mongodump         - MongoDB dump tool - for backups, snapshots, etc..
  bin/mongorestore      - MongoDB restore a dump
  bin/mongoexport       - Export a single collection to test (JSON, CSV)
  bin/mongoimport       - Import from JSON or CSV
  bin/mongofiles        - Utility for putting and getting files from MongoDB GridFS
  bin/mongostat         - Show performance statistics

RUNNING

  For command line options invoke:

    $ ./mongod --help

  To run a single server database:

    $ mkdir /data/db
    $ ./mongod
    $
    $ # The mongo javascript shell connects to localhost and test database by default:
    $ ./mongo 
    > help

DRIVERS

  Client drivers for most programming languages are available at mongodb.org.  Use the 
  shell ("mongo") for administrative tasks.

DOCUMENTATION

  http://www.mongodb.org/

MAIL LISTS AND IRC

  http://dochub.mongodb.org/core/community

32 BIT BUILD NOTES

  MongoDB uses memory mapped files.  If built as a 32 bit executable, you will
  not be able to work with large (multi-gigabyte) databases.  However, 32 bit
  builds work fine with small development databases.


refer:http://os.51cto.com/art/201101/242413.htm


========================================
----------------------------------------


========================================
----------------------------------------


========================================
----------------------------------------


========================================
----------------------------------------




